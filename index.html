<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist GSilva</title>
  <script src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      color: #2a4b7c;
      text-align: center;
    }
    #loginBtn {
      background-color: #2a4b7c;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
    }
    form {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="date"],
    input[type="time"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
      height: 80px;
    }
    button[type="submit"] {
      background-color: #28a745;
      color: white;
      margin-top: 25px;
      padding: 12px;
      font-size: 16px;
      border: none;
      width: 100%;
      border-radius: 6px;
      cursor: pointer;
    }
    #status {
      margin-top: 15px;
      font-size: 14px;
      color: #444;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Checklist GSilva</h1>

  <button id="loginBtn">Login com Microsoft</button>

  <form id="formChecklist" style="display:none;">
    <label for="titulo">Título (Title):</label>
    <input type="text" id="titulo" required placeholder="ex: Checklist Frota 29/05" />

    <label for="nomeCompleto">Nome Completo do Motorista (NomeCompleto):</label>
    <input type="text" id="nomeCompleto" required />

    <label for="data">Data da Inspeção (Data):</label>
    <input type="date" id="data" required />

    <label for="placaSider">Placa do Sider (PlacaSider):</label>
    <input type="text" id="placaSider" required />

    <h3>Checklist Motorista (Responda true ou false):</h3>
   <label for="motoristaTrajado">Motorista e ajudantes devidamente trajados?</label>
      <input list="opcoesTrajado" id="motoristaTrajado" name="motoristaTrajado" required placeholder="Escolha uma opção">
      <datalist id="opcoesTrajado">
      <option value="Sim">
      <option value="Não">
      <option value="N/A">
      </datalist>


    <label for="sinaisSonolencia">Sinais de sonolência/embriaguez? (SinaisSonolencia)</label>
<input list="opcoesSimNaoNA" id="sinaisSonolencia" name="sinaisSonolencia" required placeholder="Escolha uma opção">
 
<label for="cursoMOPPValido">Curso MOPP válido? (CursoMOPPValido)</label>
<input list="opcoesSimNaoNA" id="cursoMOPPValido" name="cursoMOPPValido" required placeholder="Escolha uma opção">
 
<label for="cnhCompativel">CNH compatível? (CNHCompativel)</label>
<input list="opcoesSimNaoNA" id="cnhCompativel" name="cnhCompativel" required placeholder="Escolha uma opção">
 
<label for="orientacaoDirecaoSegura">Motorista orientado? (OrientacaoDirecaoSegura)</label>
<input list="opcoesSimNaoNA" id="orientacaoDirecaoSegura" name="orientacaoDirecaoSegura" required placeholder="Escolha uma opção">
 
<h3>Checklist Sider (Sim/Não/N/A):</h3>
<label for="freioFunciona">Freio funcionando corretamente? (FreioFunciona)</label>
<input list="opcoesSimNaoNA" id="freioFunciona" name="freioFunciona" required placeholder="Escolha uma opção">
 
<label for="sistemaEletricoFunciona">Sistema elétrico (lanternas, setas etc.)? (SistemaEletricoFunciona)</label>
<input list="opcoesSimNaoNA" id="sistemaEletricoFunciona" name="sistemaEletricoFunciona" required placeholder="Escolha uma opção">
 
<label for="engateMangueiraSanfonada">Engate mangueira sanfonada? (EngateMangueiraSanfonada)</label>
<input list="opcoesSimNaoNA" id="engateMangueiraSanfonada" name="engateMangueiraSanfonada" required placeholder="Escolha uma opção">
 
<label for="pressaoPneusOk">Pressão dos pneus e estepes OK? (PressaoPneusOk)</label>
<input list="opcoesSimNaoNA" id="pressaoPneusOk" name="pressaoPneusOk" required placeholder="Escolha uma opção">
 
<label for="pneusConservacaoOk">Pneus em bom estado? (PneusConservacaoOk)</label>
<input list="opcoesSimNaoNA" id="pneusConservacaoOk" name="pneusConservacaoOk" required placeholder="Escolha uma opção">
 
<label for="estepeConservacaoOk">Estepe em bom estado? (EstepeConservacaoOk)</label>
<input list="opcoesSimNaoNA" id="estepeConservacaoOk" name="estepeConservacaoOk" required placeholder="Escolha uma opção">
 
<label for="parafusosRodasApertados">Parafusos apertados corretamente? (ParafusosRodasApertados)</label>
<input list="opcoesSimNaoNA" id="parafusosRodasApertados" name="parafusosRodasApertados" required placeholder="Escolha uma opção">
 
<label for="valvulasArSemVazamento">Válvulas de ar e conexões sem vazamento? (ValvulasArSemVazamento)</label>
<input list="opcoesSimNaoNA" id="valvulasArSemVazamento" name="valvulasArSemVazamento" required placeholder="Escolha uma opção">
 
<label for="faixasRefletivasBoas">Faixas refletivas em boas condições? (FaixasRefletivasBoas)</label>
<input list="opcoesSimNaoNA" id="faixasRefletivasBoas" name="faixasRefletivasBoas" required placeholder="Escolha uma opção">
 
<label for="molasBolasBalancasOk">Molas, bolas, balanças ok? (MolasBolasBalancasOk)</label>
<input list="opcoesSimNaoNA" id="molasBolasBalancasOk" name="molasBolasBalancasOk" required placeholder="Escolha uma opção">
 
<label for="documentacaoTransporteOk">Documentação necessária OK? (DocumentacaoTransporteOk)</label>
<input list="opcoesSimNaoNA" id="documentacaoTransporteOk" name="documentacaoTransporteOk" required placeholder="Escolha uma opção">
 
<label for="placaSiderCondicoes">Placa do sider em boas condições? (PlacaSiderCondicoes)</label>
<input list="opcoesSimNaoNA" id="placaSiderCondicoes" name="placaSiderCondicoes" required placeholder="Escolha uma opção">
 
<label for="acessoriosCargaOk">Acessórios de acondicionamento em boas condições? (AcessoriosCargaOk)</label>
<input list="opcoesSimNaoNA" id="acessoriosCargaOk" name="acessoriosCargaOk" required placeholder="Escolha uma opção">
 
<label for="lonasSiderDefeito">Lonas da sider com defeito? (LonasSiderDefeito)</label>
<input list="opcoesSimNaoNA" id="lonasSiderDefeito" name="lonasSiderDefeito" required placeholder="Escolha uma opção">
 
<label for="catracasSiderFunciona">Catracas funcionando? (CatracasSiderFunciona)</label>
<input list="opcoesSimNaoNA" id="catracasSiderFunciona" name="catracasSiderFunciona" required placeholder="Escolha uma opção">
 
<label for="assoalhoSiderCondicoes">Assoalho em boas condições? (AssoalhoSiderCondicoes)</label>
<input list="opcoesSimNaoNA" id="assoalhoSiderCondicoes" name="assoalhoSiderCondicoes" required placeholder="Escolha uma opção">
 
<label for="siderPossuiColunaTravessa">Possui coluna/travessa? (SiderPossuiColunaTravessa)</label>
<input list="opcoesSimNaoNA" id="siderPossuiColunaTravessa" name="siderPossuiColunaTravessa" required placeholder="Escolha uma opção">
 
<label for="portaSiderDefeito">Porta apresenta defeito? (PortaSiderDefeito)</label>
<input list="opcoesSimNaoNA" id="portaSiderDefeito" name="portaSiderDefeito" required placeholder="Escolha uma opção">
 
<label for="pinoReiQuintaRoGaviaoOk">Pino rei, quinta-roda, gavião etc. funcionando? (PinoReiQuintaRoGaviaoOk)</label>
<input list="opcoesSimNaoNA" id="pinoReiQuintaRoGaviaoOk" name="pinoReiQuintaRoGaviaoOk" required placeholder="Escolha uma opção">
 
<h3>Condições de carregamento (Sim/Não/N/A):</h3>
<label for="veiculoLimpo">Veículo visualmente limpo? (VeiculoLimpo)</label>
<input list="opcoesSimNaoNA" id="veiculoLimpo" name="veiculoLimpo" required placeholder="Escolha uma opção">
 
<label for="limpezaAntesCarregamento">Limpeza realizada antes do carregamento? (LimpezaAntesCarregamento)</label>
<input list="opcoesSimNaoNA" id="limpezaAntesCarregamento" name="limpezaAntesCarregamento" required placeholder="Escolha uma opção">
 
<label for="pastaDocumentosNoCavalo">Pasta de documentos dentro do cavalo? (PastaDocumentosNoCavalo)</label>
<input list="opcoesSimNaoNA" id="pastaDocumentosNoCavalo" name="pastaDocumentosNoCavalo" required placeholder="Escolha uma opção">
 
<label for="controlePragasValido">Controle de pragas válido? (ControlePragasValido)</label>
<input list="opcoesSimNaoNA" id="controlePragasValido" name="controlePragasValido" required placeholder="Escolha uma opção">
 
<label for="veiculoDedicadoControle">Veículo dedicado ao transporte sanitário? (VeiculoDedicadoControle)</label>
<input list="opcoesSimNaoNA" id="veiculoDedicadoControle" name="veiculoDedicadoControle" required placeholder="Escolha uma opção">

<datalist id="opcoesSimNaoNA">
  <option value="Sim">
  <option value="Não">
  <option value="N/A">
</datalist>


    <label for="observacoes">Observações Gerais (Observacoes):</label>
    <textarea id="observacoes" placeholder="Digite observações gerais..."></textarea>

    <button type="submit">Enviar Checklist</button>
  </form>

  <p id="status"></p>

  <script>
    const msalConfig = {
      auth: {
        clientId: "9f415c84-2708-4ca2-8aa8-69641dd097d0",
        authority: "https://login.microsoftonline.com/62345b7a-94ed-4671-b8f2-624e28c8253a",
        redirectUri: "https://rafaelpinto1.github.io/checklist-gsilva/"
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);
    const loginRequest = {
      scopes: ["User.Read", "Sites.ReadWrite.All"]
    };

    let accessToken = "";

    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        const loginResponse = await msalInstance.loginPopup(loginRequest);
        msalInstance.setActiveAccount(loginResponse.account);
        const tokenResponse = await msalInstance.acquireTokenSilent(loginRequest);
        accessToken = tokenResponse.accessToken;

        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("formChecklist").style.display = "block";
        document.getElementById("status").innerText = "Logado como: " + loginResponse.account.username;
      } catch (err) {
        document.getElementById("status").innerText = "Erro no login: " + err.message;
        console.error(err);
      }
    });

    document.getElementById("formChecklist").addEventListener("submit", async (e) => {
      e.preventDefault();

      // Monta objeto fields com todos os dados do formulário
      const fields = {
        Title: document.getElementById("titulo").value,
        Motorista: document.getElementById("nomeCompleto").value,
        Data: document.getElementById("data").value,
        PlacaSider: document.getElementById("placaSider").value,
        MotoristaTrajado: document.getElementById("motoristaTrajado").value,
        SinaisSonolencia: document.getElementById("sinaisSonolencia").value,
        CursoMOPPValido: document.getElementById("cursoMOPPValido").value,
        CNHCompativel: document.getElementById("cnhCompativel").value,
         OrientacaoDirecaoSegura: document.getElementById("orientacaoDirecaoSegura").value,
        FreioFunciona: document.getElementById("freioFunciona").value,
        SistemaEletricoFunciona: document.getElementById("sistemaEletricoFunciona").value,
        EngateMangueiraSanfonada: document.getElementById("engateMangueiraSanfonada").value,
        PressaoPneusOk: document.getElementById("pressaoPneusOk").value,
        PneusConservacaoOk: document.getElementById("pneusConservacaoOk").value,
        EstepeConservacaoOk: document.getElementById("estepeConservacaoOk").value,
        ParafusosRodasApertados: document.getElementById("parafusosRodasApertados").value,
        ValvulasArSemVazamento: document.getElementById("valvulasArSemVazamento").value,
        FaixasRefletivasBoas: document.getElementById("faixasRefletivasBoas").value,
        MolasBolasBalancasOk: document.getElementById("molasBolasBalancasOk").value,
        DocumentacaoTransporteOk: document.getElementById("documentacaoTransporteOk").value,
        PlacaSiderCondicoes: document.getElementById("placaSiderCondicoes").value,
        AcessoriosCargaOk: document.getElementById("acessoriosCargaOk").value,
        LonasSiderDefeito: document.getElementById("lonasSiderDefeito").value,
        CatracasSiderFunciona: document.getElementById("catracasSiderFunciona").value,
        AssoalhoSiderCondicoes: document.getElementById("assoalhoSiderCondicoes").value,
        SiderPossuiColunaTravessa: document.getElementById("siderPossuiColunaTravessa").value,
        PortaSiderDefeito: document.getElementById("portaSiderDefeito").value,
        PinoReiQuintaRoGaviaoOk: document.getElementById("pinoReiQuintaRoGaviaoOk").value,
        VeiculoLimpo: document.getElementById("veiculoLimpo").value,
        LimpezaAntesCarregamento: document.getElementById("limpezaAntesCarregamento").value,
        PastaDocumentosNoCavalo: document.getElementById("pastaDocumentosNoCavalo").value,
        ControlePragasValido: document.getElementById("controlePragasValido").value,
        VeiculoDedicadoControle: document.getElementById("veiculoDedicadoControle").value,
        Observacoes: document.getElementById("observacoes").value,
       
       
        
      };

      try {
        

    const siteResp = await fetch("https://graph.microsoft.com/v1.0/sites/gsilvainfo.sharepoint.com:/sites/Ope", {
  headers: { Authorization: `Bearer ${accessToken}` }
});
const site = await siteResp.json();

const siteId = site.id.split(',')[1]; // pega só o GUID do site

const postResp = await fetch(`https://graph.microsoft.com/v1.0/sites/${siteId}/lists/ChecklistMotoristas/items`, {
  method: "POST",
  headers: {
    Authorization: `Bearer ${accessToken}`,
    "Content-Type": "application/json"
  },
          body: JSON.stringify({ fields })
        });

        if (!postResp.ok) {
          const error = await postResp.json();
          throw new Error(error.error.message);
        }

        document.getElementById("status").innerText = "Checklist enviado com sucesso!";
        document.getElementById("formChecklist").reset();
      } catch (error) {
        document.getElementById("status").innerText = "Erro ao enviar: " + error.message;
      }
    });
  </script>
</body>
</html>
